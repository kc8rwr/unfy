<?php

class Config
{
    private static $ini_contents = null;
    
    private static function init(){
        if (null == static::$ini_contents){

            $ini_file = 'unfy.ini';
            $template_ini_file = 'unfy.ini.template';

            //ensure the config file template exists
            if (!file_exists($template_ini_file)){
                file_put_contents($template_ini_file, '');
            }
            //ensure the config file exists
            if (!file_exists($ini_file)){
                copy($template_ini_file, $ini_file);
            }
            $ini_contents = parse_ini_file($ini_file, true);

            //web base path
            if (!array_key_exists('web_base_path', $ini_contents)){
                $ini_contents['web_base_path'] = empty($ini_file['web_base_path']) ? '' : $ini_file['base_web_path'];
            }
            
            //normalize db path
            if (!(array_key_exists('database', $ini_contents) && is_array($ini_contents['database']))){
                $ini_contents['database'] = Array();
            }
            if (!(array_key_exists('path', $ini_contents['database']) && is_string($ini_contents['database']['path']))){
                $ini_contents['database']['path'] = '';
            }
            $ini_contents['database']['path'] = trim($ini_contents['database']['path']);
            if (uSTr::starts_with('.'.DIRECTORY_SEPARATOR, $ini_contents['database']['path'])){
                $ini_contents['database']['path'] = uSTr::substr($ini_contents['database']['path'], 2);
            }
            static::$ini_contents = $ini_contents;

        }
    }

    public static function getVal(){
        static::init();
        $bucket = static::$ini_contents;
        foreach (func_get_args() AS $arg){
            if (array_key_exists($arg, $bucket)){
                $bucket = $bucket[$arg];
            } else {
                return null;
            }
        }
        return $bucket;
    }
}

?>
